<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Facture {{ invoice.invoiceCode }}</title>
  <style>
    @page { size: A4; margin: 12mm; }
    * { box-sizing: border-box; }
    html, body { padding:0; margin:0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue",
                   Helvetica, Arial, "Liberation Sans", sans-serif;
      font-size: 9.6px; /* police un peu plus compacte */
      color: #0f172a;
      background: #fff;
    }

    .page { padding-top: 18mm; text-align: center; }
    .ticket {
      display: inline-block;
      vertical-align: top;
      width: 76mm;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 12px 14px;
      position: relative;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.03);
      text-align: left;
      margin: 0 auto;
    }

    .ticket:before,
    .ticket:after {
      content:"";
      position:absolute; left:14px; right:14px; height:6px;
      background: repeating-linear-gradient(
        to right, transparent 0, transparent 6px,
        rgba(2,6,23,.08) 6px, rgba(2,6,23,.08) 7.5px
      );
      opacity:.65;
    }
    .ticket:before { top: -5px; }
    .ticket:after  { bottom: -5px; }

    .muted { color:#6b7280; }
    .tiny  { font-size: 8.8px; color:#6b7280; text-align:center; }
    .center{ text-align:center; }

    .brand {
      font-weight: 800;
      font-size: 11px;
      line-height: 1.25;
      text-align: center;
    }
    .subline {
      font-size: 8.8px;
      line-height: 1.35;
      color:#6b7280;
      text-align: center;
      margin-top: 2px;
    }

    .divider {
      height: 1px;
      background: linear-gradient(to right, transparent, #e5e7eb 20%, #e5e7eb 80%, transparent);
      margin: 8px 0;
    }

    .sec-title {
      font-weight: 800;
      font-size: 9.8px;
      letter-spacing: .3px;
      text-transform: uppercase;
      color:#0f172a;
      margin-bottom: 4px;
      text-align: center;
    }

    .box {
      border: 1px solid #eef2f7;
      border-radius: 8px;
      padding: 8px;
      background: #fff;
      margin-top: 8px;
    }

    .kv {
      font-size:9.5px;
      margin: 2px 0;
    }
    .kv strong { font-weight:700; }

    .items { border: 1px solid #eef2f7; border-radius: 8px; padding: 6px 8px; background:#fff; margin-top: 6px; }
    .item { padding:6px 0; border-bottom: 1px dashed #e5e7eb; }
    .item:last-child { border-bottom:0; }

    .item-top { display:flex; justify-content:space-between; align-items: baseline; }
    .item-currency { font-weight: 600; }
    .item-amt-eur { font-weight: 700; font-size: 10px; }
    .item-sub { font-size: 8.8px; color:#6b7280; margin-top:2px; }

    .total {
      margin-top:8px;
      padding:8px 10px;
      border:1px solid #0f172a;
      border-radius:7px;
      background:#0f172a;
      color:#fff;
      font-weight:800;
      display:flex;
      align-items:center;
      justify-content:space-between;
      letter-spacing:.2px;
    }

    .footer {
      margin-top:10px;
      padding-top:8px;
      border-top:1px dashed #e5e7eb;
      color:#6b7280;
      font-size:8.8px;
      text-align:center;
      line-height:1.35;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="ticket">

      <!-- ENTÊTE -->
      <div class="brand">Mon Bureau de Change<br>Paris Centre</div>
      <div class="subline">123 Rue du Change, 75001 Paris<br>+33 1 23 45 67 89 • contact@mon-bureau-change.fr</div>

      <div class="divider"></div>

      <!-- INFOS FACTURE -->
      <div class="center" style="margin:6px 0;">
        <div><strong>Facture :</strong> {{ invoice.invoiceCode }}</div>
        <div><strong>Émise le :</strong> {{ invoice.createdAt|date('d/m/Y H:i', 'Europe/Paris') }}</div>
        <div><strong>Paiement :</strong>
          {% if invoice.paymentMethod == 'cash' %}
            Espèces
          {% elseif invoice.paymentMethod == 'card' %}
            Carte de crédit
          {% elseif invoice.paymentMethod == 'transfer' %}
            Virement
          {% else %}
            {{ invoice.paymentMethod|capitalize }}
          {% endif %}
        </div>
      </div>

      <!-- COORDONNÉES -->
      <div class="box">
        <div class="sec-title">Coordonnées</div>
        <div class="kv"><strong>Bureau :</strong> Mon Bureau de Change Paris Centre</div>
        <div class="kv"><strong>Adresse :</strong> 123 Rue du Change, 75001 Paris</div>
        <div class="kv"><strong>Téléphone :</strong> +33 1 23 45 67 89</div>
        <div class="kv"><strong>Email :</strong> contact@mon-bureau-change.fr</div>
      </div>

      <!-- CLIENT -->
      <div class="box">
        <div class="sec-title">Client</div>
        <div class="kv"><strong>Nom :</strong> {{ invoice.lastName }}</div>
        <div class="kv"><strong>Prénom :</strong> {{ invoice.firstName }}</div>
        <div class="kv"><strong>Adresse :</strong> {{ invoice.address }}</div>
      </div>

      <!-- OPÉRATIONS -->
      <div class="sec-title" style="margin-top:10px;">Détail des opérations</div>
      {% set totalEur = 0 %}
      <div class="items">
        {% for it in invoice.items %}
          {% set eurVal = it.amountEuro is not null ? it.amountEuro : 0 %}
          {% set totalEur = totalEur + eurVal %}
          <div class="item">
            <div class="item-top">
              <div>
                <span class="item-currency">{{ it.currency }}</span>
                {% if it.amountLocal is not null %}
                  &nbsp; {{ it.amountLocal|number_format(2, '.', ' ') }}
                {% endif %}
              </div>
              <div class="item-amt-eur">
                {% if it.amountEuro is not null %}
                  {{ it.amountEuro|number_format(2, '.', ' ') }} €
                {% else %}—{% endif %}
              </div>
            </div>
            <div class="item-sub">
              Tx EUR en Dev :
              {% if it.rateEurToLocal is not null %}
                {{ it.rateEurToLocal|number_format(4, '.', ' ') }}
              {% else %}—{% endif %}
              &nbsp; | &nbsp;
              Tx Dev en EUR :
              {% if it.rateLocalToEur is not null %}
                {{ it.rateLocalToEur|number_format(6, '.', ' ') }}
              {% else %}—{% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="total">
        <span>Total EUR</span>
        <span>{{ totalEur|number_format(2, '.', ' ') }} €</span>
      </div>

      <!-- NOTES -->
      <div class="box">
        <div class="sec-title">Notes</div>
        <div class="tiny">
          Les taux indiqués comprennent la marge d’échange. Conservez cette facture pour vos dossiers.<br>
          Pour toute réclamation, merci de contacter le bureau de change aux coordonnées ci-dessus.
        </div>
      </div>

      <!-- FOOTER -->
      <div class="footer">
        Mon Bureau de Change Paris Centre — SIRET 123 456 789 00010 — TVA FR12 3456789<br>
        www.mon-bureau-change.fr
      </div>

    </div>
  </div>
</body>
</html>
